@page "/autoshoutouts"
@inject DotNetTwitchBot.Bot.Commands.Misc.ShoutoutSystem ShoutoutSystem
@inject Microsoft.AspNetCore.Components.NavigationManager navigationManager
<PageTitle>Auto Shoutouts</PageTitle>

<MudButton OnClick="AddShoutout" Variant="Variant.Filled" Color="Color.Primary">Create Auto Shoutout</MudButton>

@if (autoShoutouts == null)
{
    <MudAlert Severity="Severity.Info">Loading...</MudAlert>
}
else
{
    <MudTable Items="@autoShoutouts">
        <HeaderContent>
            <MudTh>Name</MudTh>
            <MudTh>Response</MudTh>
            <MudTh>Last Shoutout</MudTh>
            <MudTh></MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd DataLabel="Response">@context.CustomMessage</MudTd>
            <MudTd DataLabel="Last Shoutout">@context.LastShoutout</MudTd>
            <MudTd DataLabel="Edit">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => Edit(context.Id)">Edit</MudButton>
            </MudTd>
            <MudTd DataLabel="Delete">
                <MudButton Variant="Variant.Filled" Color="Color.Secondary" @onclick="() => Delete(context)">Delete
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private List<DotNetTwitchBot.Bot.Models.AutoShoutout>? autoShoutouts;

    protected override async Task OnInitializedAsync()
    {
        autoShoutouts = await ShoutoutSystem.GetAutoShoutoutsAsync();
    }

    private async Task ReloadShoutouts()
    {
        autoShoutouts = await ShoutoutSystem.GetAutoShoutoutsAsync();
        StateHasChanged();
    }

    private void AddShoutout()
    {
        navigationManager.NavigateTo($"/autoshoutouts/create");
    }

    private async Task Delete(AutoShoutout autoShoutout)
    {
        await ShoutoutSystem.DeleteAutoShoutout(autoShoutout);
        await ReloadShoutouts();
    }

    private void Edit(int? id)
    {
        navigationManager.NavigateTo($"/autoshoutouts/{id}");
    }
}