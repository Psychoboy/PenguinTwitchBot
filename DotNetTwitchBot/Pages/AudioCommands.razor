@page "/audiocommands"
@inject DotNetTwitchBot.Bot.Commands.Custom.AudioCommands AudioCommand
@inject Microsoft.AspNetCore.Components.NavigationManager navigationManager

<PageTitle>Audio Commands</PageTitle>
<MudButton OnClick="AddCommand" Variant="Variant.Filled" Color="Color.Primary">Create Audio Command</MudButton>
@if (audioCommands == null)
{
    <MudAlert Severity="Severity.Info">Loading...</MudAlert>
}
else
{
    <MudTable Items="@audioCommands">
        <HeaderContent>
            <MudTh>Commands</MudTh>
            <MudTh>Audio File</MudTh>
            <MudTh>Disabled</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Command">!@context.Key</MudTd>
            <MudTd DataLabel="AudioFile">@context.Value.AudioFile</MudTd>
            <MudTd DataLabel="Disabled">@context.Value.Disabled</MudTd>
            <MudTd DataLabel="Edit">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => Edit(context.Value)">Edit
                </MudButton>
            </MudTd>
        </RowTemplate>
    </MudTable>
}

@code {
    private Dictionary<string, DotNetTwitchBot.Bot.Models.AudioCommand>? audioCommands;
    protected override Task OnInitializedAsync()
    {
        audioCommands = AudioCommand.GetAudioCommands();
        return Task.CompletedTask;
    }

    private void ReloadCommands()
    {
        audioCommands = AudioCommand.GetAudioCommands();
        StateHasChanged();
    }

    private void AddCommand()
    {
        navigationManager.NavigateTo($"/audiocommands/create");
    }

    private void Edit(DotNetTwitchBot.Bot.Models.AudioCommand item)
    {
        navigationManager.NavigateTo($"/audiocommands/{item.Id}");
    }
}